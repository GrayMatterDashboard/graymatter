import React from 'react';
import PropTypes from 'prop-types';
import Input from './Input';

class Cohorts extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      group: '',
      cohorts: [],
      students: [],
      value: '',
      svalue: '',
      student: ''
    };
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
    // this.handleGroupName = this.handleGroupName.bind(this);
  }

  // handleGroupName(event) {
  //   this.setState({ group: { groupName: event.target.value } });
  // }

  handleChange(event) {
    const target = event.target;
    const value = target.value;
    //this.state.value = target.value;
    //const name = target.name;
    if (target.name === 'cohortName') {
      this.getStudents(this.state.value);
    }

    this.setState({
      [name]: value
    });
  }

  handleSubmit(event) {
    console.table(this.state);
    // alert(this.state.group);
  }

  getStudents(cohort) {
    const url = `/admin/users.json?cohortName=${cohort}`;
    let fetchData = {
      method: 'GET',
      headers: new Headers()
    };
    fetch(url, fetchData)
      .then(response => {
        return response.json();
      })
      .then(data => {
        this.setState({ students: data });
      });
  }

  componentDidMount() {
    $(document).ready(function() {
      $('select').formSelect();
    });
    //   const url = '/admin/cohorts.json';
    //   fetch(url)
    //     .then(response => {
    //       return response.json();
    //     })
    //     .then(data => {
    //       this.setState({ cohorts: data });
    //     });
  }

  render() {
    const cohorts = this.props.cohorts;
    const students = this.state.students;
    const studentOptionItems = [];

    const optionItems = cohorts.map(cohort => (
      <option key={cohort.name}>{cohort.name}</option>
    ));

    const optionItemsStudent = students.map(cohort => (
      <option key={cohort.first_name}>{cohort.first_name}</option>
    ));

    if (students.length > 0) {
      const studentOptionItems = students.map(student => (
        <option key={student.id}>{student.first_name}</option>
      ));
      console.log('here', studentOptionItems);
    }

    //if (studentOptionItems.length > 0) {
    //// debugger;
    //}

    console.log('here before HTML students', optionItemsStudent);
    console.log('here before HTML COHORT', optionItems);
    return (
      <React.Fragment>
        <div className="input-field col s6">
          <input
            name="groupName"
            type="text"
            value={this.state.group}
            onChange={this.handleChange}
          />
          <label>Group Name</label>
        </div>

        <div className="input-field col s12">
          <form onSubmit={this.handleSubmit}>
            <label>
              Select CohortONE:
              <select
                name="cohortName"
                value={this.state.value}
                onChange={this.handleChange}
              >
                <option value="" />
                {optionItems}
              </select>
            </label>
            <input type="submit" value="Submit" />
          </form>
        </div>

        <div className="input-field col s12">
          <form onSubmit={this.handleSubmit}>
            <label>
              Select Student(s):
              <select
                name="studentName"
                value={this.state.svalue}
                onChange={this.handleChange}
              >
                {optionItemsStudent}
              </select>
            </label>
            <input type="submit" value="Submit" />
          </form>
        </div>
      </React.Fragment>
    );
  }
}

// Cohorts.propTypes = {
//   cohortName: PropTypes.string
// };

export default Cohorts;
